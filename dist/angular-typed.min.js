angular.module("angular-typed",[]).directive("typed",function($log,$timeout,$q){function _link(scope,elem,attrs){function newLine(first){var line=angular.element(document.createElement("span")).addClass("typed-line");first?elem.prepend(line):elem.append(line),elem=line}function backspace(text,currPos){var delay=Math.round(70*Math.random())+backSpeed;$timeout(function(){if(0==currPos)return currentLine<strings.length-1?(currentLine++,typeText(strings[currentLine],0)):(angular.isFunction(scope.endCallback)&&scope.$apply(scope.endCallback()),loop?startTyping():null);var nextPos=currPos-1,string=text.substr(0,nextPos);elem.text(string),backspace(text,nextPos)},delay)}function typeText(text,currPos){var delay=Math.round(70*Math.random())+typeSpeed;$timeout(function(){if(currPos==text.length)if(currentLine==strings.length-1){if(!endBackspace)return angular.isFunction(scope.endCallback)&&scope.$apply(scope.endCallback()),loop?startTyping():null;backspace(text,currPos)}else removeLine?backspace(text,currPos):$timeout(function(){return currentLine++,typeText(strings[currentLine],0)},endlineWait);else{var nextPos=currPos+1,string=text.substr(0,nextPos);elem.text(string),typeText(text,nextPos)}},delay)}function startTyping(first){$timeout(function(){return first&&angular.isFunction(scope.startCallback)&&(scope.startCallback(),newLine(!0)),currentLine=startLine,typeText(strings[currentLine],0)},startTimeout)}var strings=scope.typeStrings||(elem.text()?[elem.text().trim().replace(/\s+/g," ")]:null);if(!strings)return void $log.info("angular-typed: No strings to type found on element: ",elem[0]);var startLine=attrs.startLine||0,currentLine=startLine,startTimeout=parseInt(attrs.startTimeout)||0,loop="loop"in attrs&&"false"!=attrs.loop,typeSpeed=parseInt(attrs.typeSpeed)||0,backSpeed=parseInt(attrs.backSpeed)||0,removeLine=attrs.removeLine||!0,endlineWait=attrs.endlineWait||250,endBackspace=attrs.endBackspace||!1,cursor=angular.element(document.createElement("span")).addClass("typed-cursor").text("|");return elem.empty(),elem.append(cursor),startTyping(!0)}var _scope={typeStrings:"=?",startCallback:"&",endCallback:"&"},directive={restrict:"AE",replace:!1,scope:_scope,link:_link};return directive});